<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
         "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hobby.challenge.fobackend.mapper.ChallengeMapper">
	<!-- Challenge User 조인용 resultMap-->
 	<resultMap id="ChallengeWithCreator" type="com.hobby.challenge.fobackend.entity.Challenge">
	    <id column="challengeId" property="challengeId"/>
	    <result column="title" property="title"/>
	    <result column="description" property="description"/>
	    <result column="startDate" property="startDate"/>
	    <result column="endDate" property="endDate"/>
	    <result column="categoryId" property="categoryId"/>
	    <result column="createdBy" property="createdBy"/>
	    <result column="createdDate" property="createdDate"/>
	    <result column="modifiedDate" property="modifiedDate"/>
	    
	    <!-- CREATED_BY로 USER 테이블(USER_ID)와 조인 -->
		<association property="creator" javaType="com.hobby.challenge.fobackend.entity.User">
			<id column="userId" property="userId"/>
      		<result column="nickname" property="nickname"/>
    	</association>
 	</resultMap>

	<!-- 전체 챌린지 목록 조회 -->
	<select id="findAll" resultMap="ChallengeWithCreator">
		SELECT C.CHALLENGE_ID AS challengeId
			 , C.TITLE AS title
			 , C.DESCRIPTION AS description
			 , C.CATEGORY_ID AS categoryId
			 , C.CREATED_BY AS createdBy
			 , C.START_DATE AS startDate
			 , C.END_DATE AS endDate
			 , C.CREATED_DATE AS createdDate
			 , C.MODIFIED_DATE AS modifiedDate
			 , U.USER_ID AS userId
			 , U.NICKNAME AS nickname <!-- 생성자 닉네임 -->
			FROM CHALLENGE C
	INNER JOIN USER U 
			ON C.CREATED_BY = U.USER_ID
	ORDER BY C.CREATED_DATE DESC
	</select>

	<!-- 챌린지 생성 -->
	<insert id="insertChallenge"
			parameterType="com.hobby.challenge.fobackend.entity.Challenge"
			useGeneratedKeys="true"
			keyProperty="challengeId">
		INSERT INTO CHALLENGE (TITLE
							, DESCRIPTION
							, START_DATE
							, END_DATE
							, CATEGORY_ID
							, CREATED_BY)
		VALUES (#{title}
			 , #{description}
			 , #{startDate}
			 , #{endDate}
			 , #{categoryId}
			 , #{createdBy})
	</insert>
	
</mapper>